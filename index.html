<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc ti·∫øng Anh th·∫≠t d·ªÖ</title>
    <style>
        body { font-family: 'Comic Sans MS', 'Arial', sans-serif; background-color: #e0f7fa; text-align: center; padding: 20px; }
        .card { background: white; border-radius: 25px; padding: 30px; max-width: 450px; margin: 0 auto; box-shadow: 0 10px 25px rgba(0,0,0,0.2); border: 6px solid #FFD700; position: relative; }
        
        .img-box { width: 220px; height: 220px; margin: 0 auto; overflow: hidden; border-radius: 15px; border: 3px dashed #ddd; background: #fff; }
        img { width: 100%; height: 100%; object-fit: contain; }
        
        /* ƒê√£ s·ª≠a H1 theo y√™u c·∫ßu */
        h1 { color: #ff6f00; font-size: 28px; margin-bottom: 5px; }
        h2 { color: #333; font-size: 45px; margin: 10px 0; letter-spacing: 2px; }
        
        .btn { border: none; border-radius: 50px; cursor: pointer; margin: 10px; box-shadow: 0 5px rgba(0,0,0,0.2); transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; }
        .btn:active { transform: translateY(3px); box-shadow: 0 2px rgba(0,0,0,0.2); }
        .btn:disabled { background-color: #ccc !important; cursor: not-allowed; box-shadow: none; }

        .btn-mic { background-color: #4CAF50; color: white; padding: 15px 40px; font-size: 22px; width: 80%; }
        .btn-sample { background-color: #2196F3; color: white; padding: 10px 20px; font-size: 16px; }
        .btn-nav { background-color: #FF9800; color: white; padding: 10px 20px; font-size: 18px; width: 40px; height: 40px; border-radius: 50%; }

        .stars { font-size: 50px; color: #FFD700; height: 65px; margin: 10px 0; text-shadow: 2px 2px 0px #fff, -1px -1px 0 #bbb; }
        .feedback { font-size: 18px; color: #555; height: 30px; margin-bottom: 15px; font-style: italic; }
        .phonetic { color: #888; font-size: 22px; margin-bottom: 15px; font-family: 'Times New Roman', serif; }
        
        .listening { animation: pulse 1.5s infinite; background-color: #ff5722 !important; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="card">
    <h1>üêª H·ªçc ph√°t √¢m üê∞</h1>
    
    <div class="img-box">
        <img id="word-img" src="" alt="Word Image" onerror="this.src='https://via.placeholder.com/200?text=No+Image'">
    </div>

    <h2 id="word-text">WORD</h2>
    <div class="phonetic" id="phonetic">/IPA/</div>

    <button class="btn btn-sample" onclick="playSample()">üîä Nghe m·∫´u</button>

    <div class="stars" id="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</div>
    <div class="feedback" id="feedback">B·∫°n h√£y b·∫•m n√∫t xanh v√† ƒë·ªçc to nh√©!</div>

    <button id="mic-btn" class="btn btn-mic" onclick="startListening()">üé§ ƒê·ªçc Ngay</button>

    <div style="margin-top: 25px; display: flex; justify-content: space-between; padding: 0 20px;">
        <button class="btn btn-nav" onclick="prevWord()">‚óÄ</button>
        <button class="btn btn-nav" onclick="nextWord()">‚ñ∂</button>
    </div>
</div>

<script>
    // D·ªØ li·ªáu t·ª´ v·ª±ng
    const words = [
        { word: "ear", ipa: "/…™r/", img: "ear.png" }, 
        { word: "beer", ipa: "/…™r/", img: "beer.png" }, 
        { word: "deer", ipa: "/…™r/", img: "deer.png" }, 
        { word: "cheer", ipa: "/…™r/", img: "cheer.png" }, 
        { word: "tear", ipa: "/…™r/", img: "tear.png" }, 
        { word: "bear", ipa: "/…õr/", img: "bear.png" }, 
        { word: "pear", ipa: "/…õr/", img: "pear.png" }, 
        { word: "share", ipa: "/…õr/", img: "share.png" }, 
        { word: "stair", ipa: "/…õr/", img: "stair.png" }, 
        { word: "chair", ipa: "/…õr/", img: "chair.png" }  
    ];

    let currentIndex = 0;
    let recognitionTimeout;
    let recognition;

    // S·ª¨ D·ª§NG FILE √ÇM THANH C·ª§C B·ªò (ƒê·ªÉ kh·∫Øc ph·ª•c l·ªói kh√¥ng c√≥ ti·∫øng)
    const soundEffects = {
        win: new Audio("win.mp3"),     // B·∫°n c·∫ßn t·∫£i file win.mp3 ƒë·ªÉ v√†o c√πng th∆∞ m·ª•c
        correct: new Audio("correct.mp3"), // B·∫°n c·∫ßn t·∫£i file correct.mp3
        wrong: new Audio("wrong.mp3")    // B·∫°n c·∫ßn t·∫£i file wrong.mp3
    };

    function loadWord(index) {
        document.getElementById('word-text').innerText = words[index].word.toUpperCase();
        document.getElementById('phonetic').innerText = words[index].ipa;
        document.getElementById('word-img').src = words[index].img;
        resetState();
    }

    function resetState() {
        document.getElementById('stars').innerText = "‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ";
        document.getElementById('feedback').innerText = "S·∫µn s√†ng...";
        document.getElementById('mic-btn').disabled = false;
        document.getElementById('mic-btn').className = "btn btn-mic";
        document.getElementById('mic-btn').innerText = "üé§ ƒê·ªçc Ngay";
        if(recognition) { try { recognition.stop(); } catch(e){} }
        clearTimeout(recognitionTimeout);
    }

    function nextWord() {
        if (currentIndex < words.length - 1) { currentIndex++; loadWord(currentIndex); }
    }

    function prevWord() {
        if (currentIndex > 0) { currentIndex--; loadWord(currentIndex); }
    }

    // CH·ª®C NƒÇNG NGHE M·∫™U (ƒê√£ t·ªëi ∆∞u)
    function playSample() {
        // H·ªßy c√°c l·ªánh ƒë·ªçc c≈© ƒë·ªÉ tr√°nh b·ªã k·∫πt
        window.speechSynthesis.cancel();
        
        const text = words[currentIndex].word;
        const utterance = new SpeechSynthesisUtterance(text);
        
        // C·ªë g·∫Øng l·∫•y gi·ªçng chu·∫©n ti·∫øng Anh M·ªπ
        let voices = window.speechSynthesis.getVoices();
        let selectedVoice = voices.find(voice => voice.lang === 'en-US');
        if(selectedVoice) utterance.voice = selectedVoice;

        utterance.lang = 'en-US'; 
        utterance.rate = 0.8; 
        
        // X·ª≠ l√Ω s·ª± ki·ªán n·∫øu l·ªói
        utterance.onerror = function(e) {
            console.error('TTS Error:', e);
            alert("L·ªói √¢m thanh: H√£y ki·ªÉm tra xem ƒëi·ªán tho·∫°i c√≥ ƒëang t·∫Øt chu√¥ng kh√¥ng nh√©!");
        };

        window.speechSynthesis.speak(utterance);
    }

    // ƒê·∫£m b·∫£o danh s√°ch gi·ªçng ƒë·ªçc ƒë∆∞·ª£c t·∫£i (Fix l·ªói tr√™n Chrome)
    window.speechSynthesis.onvoiceschanged = function() {
        window.speechSynthesis.getVoices();
    };

    function startListening() {
        if (!('webkitSpeechRecognition' in window)) {
            alert("Thi·∫øt b·ªã kh√¥ng h·ªó tr·ª£. H√£y d√πng Google Chrome!");
            return;
        }

        // D·ª´ng ƒë·ªçc m·∫´u n·∫øu ƒëang ƒë·ªçc
        window.speechSynthesis.cancel();

        recognition = new webkitSpeechRecognition();
        recognition.lang = 'en-US';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;
        recognition.continuous = false;

        document.getElementById('mic-btn').innerText = "üëÇ ƒêang nghe b·∫°n...";
        document.getElementById('mic-btn').className = "btn btn-mic listening";
        document.getElementById('mic-btn').disabled = true;
        document.getElementById('feedback').innerText = "B·∫°n ƒë·ªçc to l√™n n√†o...";

        try {
            recognition.start();
        } catch(e) {
            recognition.stop();
            setTimeout(() => recognition.start(), 100);
        }

        clearTimeout(recognitionTimeout);
        recognitionTimeout = setTimeout(() => {
            recognition.stop();
            document.getElementById('feedback').innerText = "H·∫øt gi·ªù! B·∫°n ƒë·ªçc l·∫°i nh√©.";
            resetBtn();
        }, 5000); 

        recognition.onresult = function(event) {
            clearTimeout(recognitionTimeout);
            const speechResult = event.results[0][0].transcript.toLowerCase();
            const targetWord = words[currentIndex].word;
            
            if (speechResult.includes(targetWord)) {
                showResult(5, "Tuy·ªát v·ªùi! Ch√≠nh x√°c 100%! üéâ");
            } else if (isCloseEnough(speechResult, targetWord)) {
                showResult(3, "Kh√° l·∫Øm! (" + speechResult + ")");
            } else {
                showResult(1, "Ch∆∞a ƒë√∫ng. (M√°y nghe: " + speechResult + ")");
            }
        };

        recognition.onerror = function(event) {
            clearTimeout(recognitionTimeout);
            if(event.error === 'no-speech') {
                document.getElementById('feedback').innerText = "Kh√¥ng nghe th·∫•y ti·∫øng...";
            } else {
                document.getElementById('feedback').innerText = "Th·ª≠ l·∫°i nh√©.";
            }
            resetBtn();
        };

        recognition.onend = function() {
           clearTimeout(recognitionTimeout);
           if(document.getElementById('mic-btn').disabled && document.getElementById('stars').innerText === "‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ") {
               resetBtn();
           }
        };
    }

    function isCloseEnough(heard, target) {
        return heard.charAt(0) === target.charAt(0) && heard.length >= target.length - 1;
    }

    function showResult(starCount, message) {
        let stars = "";
        for (let i = 0; i < 5; i++) {
            stars += (i < starCount) ? "‚≠ê" : "‚òÜ";
        }
        document.getElementById('stars').innerText = stars;
        document.getElementById('feedback').innerText = message;
        
        // Ph√°t √¢m thanh t·ª´ file c·ª•c b·ªô
        if (starCount === 5) playSound('win');
        else if (starCount >= 3) playSound('correct');
        else playSound('wrong');

        resetBtn();
    }

    function resetBtn() {
        document.getElementById('mic-btn').className = "btn btn-mic";
        document.getElementById('mic-btn').disabled = false;
        document.getElementById('mic-btn').innerText = "üé§ ƒê·ªçc L·∫°i";
    }

    function playSound(type) {
        // Reset √¢m thanh
        soundEffects.win.pause(); soundEffects.win.currentTime = 0;
        soundEffects.correct.pause(); soundEffects.correct.currentTime = 0;
        soundEffects.wrong.pause(); soundEffects.wrong.currentTime = 0;

        // C·ªë g·∫Øng ph√°t v√† b·∫Øt l·ªói n·∫øu file kh√¥ng t·ªìn t·∫°i
        let promise;
        if(type === 'win') promise = soundEffects.win.play();
        if(type === 'correct') promise = soundEffects.correct.play();
        if(type === 'wrong') promise = soundEffects.wrong.play();

        if (promise !== undefined) {
            promise.catch(error => {
                console.log("Kh√¥ng t√¨m th·∫•y file √¢m thanh ho·∫∑c tr√¨nh duy·ªát ch·∫∑n t·ª± ƒë·ªông ph√°t: " + error);
                // Kh√¥ng l√†m g√¨ c·∫£ ƒë·ªÉ tr√°nh l·ªói crash
            });
        }
    }

    loadWord(0);
</script>

</body>
</html>
