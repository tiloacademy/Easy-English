<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>H·ªçc ti·∫øng Anh c√πng B√©</title>
    <style>
        /* --- C√ÄI ƒê·∫∂T CHUNG --- */
        :root {
            --primary-color: #00A4EF; 
            --bg-color: #fdf2e9; /* M√†u n·ªÅn nh·∫π nh√†ng */
        }
        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            background-color: var(--bg-color); 
            background-image: url('https://www.transparenttextures.com/patterns/notebook.png');
            text-align: center; padding: 10px; margin: 0; user-select: none; 
            height: 100vh; overflow: hidden;
            display: flex; flex-direction: column; justify-content: center;
        }
        
        /* KHUNG TH·∫∫ CH√çNH */
        .card-container { 
            background: white; border-radius: 20px; 
            padding: 15px; 
            width: 100%; max-width: 500px; margin: 0 auto; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.15); 
            height: 90vh; display: flex; flex-direction: column;
            box-sizing: border-box; position: relative;
        }

        /* --- 1. GIAO DI·ªÜN H·ªåC T·∫¨P (LEARNING MODE) --- */
        #learning-container {
            display: flex; flex-direction: column; height: 100%;
            justify-content: space-between;
        }

        h1 { font-size: 22px; margin: 0 0 10px 0; color: #ff6f00; }
        
        #word-img { 
            width: 100%; height: 250px; 
            object-fit: contain; border-radius: 15px; margin-bottom: 10px;
        }

        .word-display { font-size: 36px; font-weight: bold; color: #333; margin: 5px 0; }
        .phonetic { font-size: 20px; color: #666; font-family: 'Times New Roman', serif; margin-bottom: 10px; }
        
        .stars { font-size: 30px; color: #FFD700; margin: 5px 0; height: 40px; }
        .feedback { font-size: 16px; color: #555; height: 20px; font-style: italic; }

        /* N√∫t Mic */
        .btn-mic { 
            background-color: #4CAF50; color: white; border: none; 
            padding: 12px 0; width: 100%; border-radius: 50px; 
            font-size: 20px; font-weight: bold; margin: 10px 0;
            box-shadow: 0 4px #2e7d32; cursor: pointer;
        }
        .btn-mic:active { transform: translateY(2px); box-shadow: 0 1px #2e7d32; }

        /* Thanh ƒëi·ªÅu h∆∞·ªõng b√™n d∆∞·ªõi */
        .nav-bar { display: flex; justify-content: space-between; align-items: center; margin-top: auto; }
        .btn-arrow { background: #FF9800; border: none; width: 45px; height: 45px; border-radius: 50%; font-size: 20px; color: white; cursor: pointer; box-shadow: 0 3px #f57c00; }
        
        /* N√∫t Nghe l·∫°i (TO L√äN theo y√™u c·∫ßu) */
        .btn-listen-large {
            background-color: white; color: #2196F3;
            border: 2px solid #2196F3;
            padding: 10px 30px; font-size: 18px; border-radius: 30px;
            font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px;
            box-shadow: 0 3px rgba(33, 150, 243, 0.2);
        }
        .btn-listen-large:active { background-color: #e3f2fd; transform: translateY(2px); }

        /* --- 2. GIAO DI·ªÜN GAME (GAME MODE) --- */
        #game-container {
            display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
            flex-direction: column; align-items: center; justify-content: flex-start;
            height: 100%; width: 100%;
        }

        /* ƒê·ªìng h·ªì ƒë·∫øm gi·ªù (Gi·ªëng h√¨nh b·∫°n g·ª≠i) */
        .timer-badge {
            background: #fff; border: 2px solid #ff9800; color: #d35400;
            padding: 8px 20px; border-radius: 20px;
            font-size: 20px; font-weight: bold;
            margin-bottom: 20px;
            display: inline-flex; align-items: center; gap: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* L∆∞·ªõi th·∫ª b√†i 3-2-3-2 */
        .game-grid {
            display: flex; flex-direction: column; gap: 10px;
            align-items: center; justify-content: center;
            flex-grow: 1;
        }
        .game-row { display: flex; gap: 10px; justify-content: center; }

        .card-flip {
            width: 70px; height: 95px;
            perspective: 1000px; cursor: pointer;
        }
        .card-inner {
            position: relative; width: 100%; height: 100%;
            text-align: center; transition: transform 0.5s;
            transform-style: preserve-3d;
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        .card-flip.flipped .card-inner { transform: rotateY(180deg); }
        .card-flip.matched .card-inner { opacity: 0; pointer-events: none; transition: opacity 0.5s; }

        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%;
            -webkit-backface-visibility: hidden; backface-visibility: hidden;
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid #5d4037;
        }
        /* M·∫∑t √∫p (S·ªë 1-10) */
        .card-front { background-color: #8d6e63; color: #3e2723; font-size: 24px; font-weight: bold; }
        /* M·∫∑t ng·ª≠a (H√¨nh) */
        .card-back { background-color: white; transform: rotateY(180deg); padding: 5px; }
        .card-back img { width: 80%; height: 80%; object-fit: contain; }
        .card-back span { font-size: 14px; font-weight: bold; color: #333; }

        /* N√∫t ƒëi·ªÅu khi·ªÉn game */
        .game-controls {
            width: 100%; display: flex; justify-content: center; gap: 20px; margin-top: 10px;
        }
        .btn-game {
            border: none; padding: 12px 25px; border-radius: 25px;
            font-size: 16px; font-weight: bold; color: white; cursor: pointer;
            display: flex; align-items: center; gap: 5px;
        }
        .btn-replay { background: #e67e22; box-shadow: 0 4px #d35400; }
        .btn-exit { background: #e74c3c; box-shadow: 0 4px #c0392b; }
        .btn-game:active { transform: translateY(2px); box-shadow: none; }

        /* M√†n h√¨nh th·∫Øng */
        #win-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 20px; z-index: 100;
        }
        .win-title { color: #27ae60; font-size: 32px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="card-container">
    
    <div id="learning-container">
        <h1>üêª H·ªçc Ti·∫øng Anh üê∞</h1>
        
        <img id="word-img" src="" alt="Learning">
        
        <div id="text-area">
            <div class="word-display" id="word-text">...</div>
            <div class="phonetic" id="phonetic">...</div>
        </div>

        <div class="stars" id="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</div>
        <div class="feedback" id="feedback">S·∫µn s√†ng!</div>

        <button id="mic-btn" class="btn-mic" onclick="startListening()">üé§ ƒê·ªçc Ngay</button>

        <div class="nav-bar">
            <button class="btn-arrow" onclick="prevItem()">‚óÄ</button>
            <button class="btn-listen-large" onclick="playAudio()">üîä Nghe l·∫°i</button>
            <button class="btn-arrow" onclick="nextItem()">‚ñ∂</button>
        </div>
    </div>

    <div id="game-container">
        <div class="timer-badge">
            ‚è±Ô∏è <span id="timer">00:00</span>
        </div>

        <div class="game-grid" id="game-grid"></div>

        <div class="game-controls">
            <button class="btn-game btn-exit" onclick="exitGame()">‚ùå Tho√°t</button>
            <button class="btn-game btn-replay" onclick="initGame()">üîÑ Ch∆°i l·∫°i</button>
        </div>

        <div id="win-overlay">
            <h2 class="win-title">üéâ Xu·∫•t s·∫Øc! üéâ</h2>
            <p id="win-time" style="font-size: 18px; color: #555;">Ho√†n th√†nh trong...</p>
            <div style="margin-top: 20px;">
                <button class="btn-game btn-replay" onclick="initGame()">Ch∆°i l·∫°i</button>
                <button class="btn-game btn-exit" style="background:#2196F3; margin-left:10px;" onclick="exitGame()">B√†i ti·∫øp ‚û°</button>
            </div>
        </div>
    </div>

</div>

<script>
    // --- D·ªÆ LI·ªÜU B√ÄI H·ªåC ---
    const items = [
        // C√°c t·ª´ v·ª±ng (Xu·∫•t hi·ªán tr∆∞·ªõc)
        { type: "word", text: "Beer", ipa: "/b…™…ôr/", img: "https://cdn-icons-png.flaticon.com/512/931/931949.png", speak: "beer" },
        { type: "word", text: "Deer", ipa: "/d…™…ôr/", img: "https://cdn-icons-png.flaticon.com/512/2313/2313328.png", speak: "deer" },
        { type: "word", text: "Ear", ipa: "/…™…ôr/", img: "https://cdn-icons-png.flaticon.com/512/822/822102.png", speak: "ear" },
        { type: "word", text: "Chair", ipa: "/t É…õ…ôr/", img: "https://cdn-icons-png.flaticon.com/512/2663/2663523.png", speak: "chair" },
        
        // M√†n ch∆°i Game (Xu·∫•t hi·ªán sau khi h·ªçc xong c√°c t·ª´)
        { 
            type: "game", 
            words: ["beer", "deer", "ear", "chair", "bear"], // C√°c t·ª´ d√πng trong game
            images: [
                "https://cdn-icons-png.flaticon.com/512/931/931949.png",
                "https://cdn-icons-png.flaticon.com/512/2313/2313328.png",
                "https://cdn-icons-png.flaticon.com/512/822/822102.png",
                "https://cdn-icons-png.flaticon.com/512/2663/2663523.png",
                "https://cdn-icons-png.flaticon.com/512/427/427514.png"
            ]
        }
    ];

    let currentIndex = 0;
    
    // Bi·∫øn cho Game
    let timerInterval;
    let seconds = 0;
    let hasFlipped = false;
    let lockBoard = false;
    let firstCard, secondCard;
    let matchCount = 0;

    // --- KH·ªûI T·∫†O ---
    window.onload = () => {
        loadItem(0);
    };

    function loadItem(index) {
        currentIndex = index;
        const item = items[index];
        const learnDiv = document.getElementById('learning-container');
        const gameDiv = document.getElementById('game-container');

        // Reset tr·∫°ng th√°i
        window.speechSynthesis.cancel();
        
        if (item.type === 'word') {
            // HI·ªÜN GIAO DI·ªÜN H·ªåC, ·∫®N GAME
            learnDiv.style.display = 'flex';
            gameDiv.style.display = 'none';

            document.getElementById('word-img').src = item.img;
            document.getElementById('word-text').innerText = item.text;
            document.getElementById('phonetic').innerText = item.ipa;
            document.getElementById('stars').innerText = "‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ";
            document.getElementById('feedback').innerText = "S·∫µn s√†ng!";
            
            // T·ª± ƒë·ªông ƒë·ªçc sau 0.5s
            setTimeout(() => playAudio(), 500);

        } else if (item.type === 'game') {
            // HI·ªÜN GIAO DI·ªÜN GAME, ·∫®N H·ªåC
            learnDiv.style.display = 'none';
            gameDiv.style.display = 'flex';
            
            initGame();
        }
    }

    // --- C√ÅC H√ÄM H·ªåC T·∫¨P ---
    function nextItem() {
        if (currentIndex < items.length - 1) loadItem(currentIndex + 1);
    }
    
    function prevItem() {
        if (currentIndex > 0) loadItem(currentIndex - 1);
    }

    function playAudio() {
        const item = items[currentIndex];
        if (item.type !== 'word') return;
        const u = new SpeechSynthesisUtterance(item.speak);
        u.lang = 'en-US';
        window.speechSynthesis.speak(u);
    }

    // Gi·∫£ l·∫≠p nh·∫≠n di·ªán gi·ªçng n√≥i (ƒë·ªÉ code g·ªçn, b·∫°n c√≥ th·ªÉ thay b·∫±ng code mic th·∫≠t)
    function startListening() {
        document.getElementById('feedback').innerText = "ƒêang nghe...";
        setTimeout(() => {
            document.getElementById('stars').innerText = "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê";
            document.getElementById('feedback').innerText = "Tuy·ªát v·ªùi!";
            new Audio("https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg").play();
        }, 1500);
    }

    // --- C√ÅC H√ÄM TR√í CH∆†I ---
    function initGame() {
        const item = items[currentIndex];
        const grid = document.getElementById('game-grid');
        const winOverlay = document.getElementById('win-overlay');
        
        // Reset
        grid.innerHTML = '';
        winOverlay.style.display = 'none';
        matchCount = 0;
        seconds = 0;
        document.getElementById('timer').innerText = "00:00";
        clearInterval(timerInterval);
        startTimer();

        // 1. T·∫°o danh s√°ch th·∫ª (5 c·∫∑p = 10 th·∫ª)
        let cards = [];
        // L·∫•y 5 t·ª´/·∫£nh ƒë·∫ßu ti√™n trong data game
        for(let i=0; i<5; i++) {
            // Th·∫ª H√¨nh
            cards.push({ id: i, type: 'img', content: `<img src="${item.images[i]}">`, speak: item.words[i] });
            // Th·∫ª Ch·ªØ
            cards.push({ id: i, type: 'text', content: `<span>${item.words[i].toUpperCase()}</span>`, speak: item.words[i] });
        }

        // 2. Tr·ªôn ng·∫´u nhi√™n n·ªôi dung b√™n trong
        cards.sort(() => 0.5 - Math.random());

        // 3. X·∫øp theo b·ªë c·ª•c 3 - 2 - 3 - 2
        const layout = [3, 2, 3, 2];
        let cardIdx = 0;
        let displayNum = 1; // S·ªë th·ª© t·ª± m·∫∑t √∫p

        layout.forEach(count => {
            const row = document.createElement('div');
            row.className = 'game-row';
            
            for(let k=0; k<count; k++) {
                if(cardIdx >= cards.length) break;
                
                const data = cards[cardIdx];
                const card = document.createElement('div');
                card.className = 'card-flip';
                card.dataset.id = data.id; // ID ƒë·ªÉ kh·ªõp c·∫∑p
                card.dataset.speak = data.speak;

                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">${displayNum}</div>
                        <div class="card-back">${data.content}</div>
                    </div>
                `;

                card.addEventListener('click', flipCard);
                row.appendChild(card);
                
                cardIdx++;
                displayNum++;
            }
            grid.appendChild(row);
        });
    }

    function flipCard() {
        if (lockBoard) return;
        if (this === firstCard) return;

        this.classList.add('flipped');
        
        // ƒê·ªçc t·ª´ khi l·∫≠t
        let u = new SpeechSynthesisUtterance(this.dataset.speak);
        window.speechSynthesis.speak(u);

        if (!hasFlipped) {
            hasFlipped = true;
            firstCard = this;
            return;
        }

        secondCard = this;
        checkForMatch();
    }

    function checkForMatch() {
        let isMatch = firstCard.dataset.id === secondCard.dataset.id;
        isMatch ? disableCards() : unflipCards();
    }

    function disableCards() {
        lockBoard = true; 
        setTimeout(() => {
            firstCard.classList.add('matched');
            secondCard.classList.add('matched');
            resetBoard();
            matchCount++;
            if(matchCount === 5) endGame();
        }, 500);
    }

    function
