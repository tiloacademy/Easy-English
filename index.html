<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>H·ªçc ti·∫øng Anh th·∫≠t d·ªÖ</title>
    <style>
        /* --- C√ÄI ƒê·∫∂T CHUNG & M√ÄU S·∫ÆC --- */
        :root {
            --primary-color: #00A4EF; /* Xanh ki·ªÉu Wordwall */
            --secondary-color: #FFB900;
            --success-color: #7FBA00; /* Xanh l√° ƒë√∫ng */
            --error-color: #F25022; /* ƒê·ªè sai */
            --card-shadow: 0 4px 0px rgba(0,0,0,0.1), 0 8px 15px rgba(0,0,0,0.1); /* T·∫°o ƒë·ªô d√†y 3D */
            --card-shadow-hover: 0 8px 0px rgba(0,0,0,0.1), 0 15px 20px rgba(0,0,0,0.15);
        }
        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background-color: #f0f2f5; /* N·ªÅn s√°ng hi·ªán ƒë·∫°i */
            text-align: center; padding: 10px; margin: 0; user-select: none; 
        }
        
        /* Container ch√≠nh */
        .card { 
            background: white; border-radius: 25px; padding: 20px; 
            max-width: 600px; margin: 10px auto; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            border: none; /* B·ªè vi·ªÅn v√†ng c≈© */
            min-height: 600px; position: relative; box-sizing: border-box; 
        }

        /* KHU V·ª∞C HI·ªÇN TH·ªä CHUNG (B√†n ch∆°i) */
        .content-box { 
            width: 100%; margin: 0 auto; border-radius: 20px; 
            background: #eef2f7; /* M√†u n·ªÅn b√†n ch∆°i nh·∫π nh√†ng */
            border: 3px solid #dce4ec;
            position: relative; min-height: 320px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            padding: 10px; box-sizing: border-box;
        }
        
        /* Style cho ·∫¢nh b√†i h·ªçc */
        #word-img { 
            max-width: 95%; max-height: 280px; object-fit: contain; 
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            background: white; padding: 5px;
        }

        /* --- STYLE M·ªöI CHO GAME MEMORY (L·∫¨T H√åNH) --- */
        .game-area { width: 100%; display: none; flex-direction: column; align-items: center; gap: 15px; padding: 5px; box-sizing: border-box; }
        
        .memory-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 12px; /* Kho·∫£ng c√°ch r·ªông h∆°n x√≠u */
            width: 100%; max-width: 420px;
            perspective: 1000px;
        }

        .memory-card {
            background-color: transparent;
            width: 100%; aspect-ratio: 1/1; 
            cursor: pointer;
            position: relative;
            /* Hi·ªáu ·ª©ng khi di chu·ªôt v√†o: N·ªïi l√™n */
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1;
        }
        .memory-card:hover { transform: translateY(-4px); z-index: 2; } /* Nh·∫•c nh·∫π l√™n */

        .memory-inner {
            position: relative; width: 100%; height: 100%;
            text-align: center;
            transition: transform 0.5s cubic-bezier(0.4, 0.0, 0.2, 1); /* L·∫≠t m∆∞·ª£t h∆°n */
            transform-style: preserve-3d;
            border-radius: 15px;
            box-shadow: var(--card-shadow); /* T·∫°o ƒë·ªô d√†y */
        }
        .memory-card:hover .memory-inner { box-shadow: var(--card-shadow-hover); }

        .memory-card.flipped .memory-inner { transform: rotateY(180deg); }
        
        /* Hi·ªáu ·ª©ng khi ƒê√öNG */
        .memory-card.matched .memory-inner { 
            transform: rotateY(180deg) scale(0.9); /* Thu nh·ªè l·∫°i x√≠u */
            opacity: 0.6; 
            box-shadow: none; /* M·∫•t b√≥ng */
            transition: all 0.5s;
        }
        .memory-card.matched .memory-back {
            background: var(--success-color); /* Chuy·ªÉn n·ªÅn xanh l√° */
            color: white; border-color: transparent;
        }

        /* Hi·ªáu ·ª©ng khi SAI (Rung l·∫Øc m·∫°nh) */
        .memory-card.shake { animation: intenseShake 0.5s; }
        .memory-card.shake .memory-back { background-color: var(--error-color) !important; color: white; }
        @keyframes intenseShake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-8px) rotate(-2deg); }
            40% { transform: translateX(8px) rotate(2deg); }
            60% { transform: translateX(-8px) rotate(-1deg); }
            80% { transform: translateX(8px) rotate(1deg); }
        }

        .memory-front, .memory-back {
            position: absolute; width: 100%; height: 100%;
            -webkit-backface-visibility: hidden; backface-visibility: hidden;
            border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            box-sizing: border-box;
            border: 3px solid white; /* Vi·ªÅn tr·∫Øng s·∫°ch s·∫Ω */
            overflow: hidden;
        }

        /* M·∫∑t sau (√öp - M√†u xanh Wordwall) */
        .memory-front { 
            background: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%); /* Gradient xanh hi·ªán ƒë·∫°i */
            color: white; font-size: 32px; font-weight: 900; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        
        /* M·∫∑t tr∆∞·ªõc (Ng·ª≠a - Tr·∫Øng s·∫°ch) */
        .memory-back { 
            background-color: white; color: #333; 
            transform: rotateY(180deg); 
            padding: 5px;
        }
        .memory-back img { max-width: 90%; max-height: 90%; object-fit: contain; filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.1)); }
        .memory-back span { font-weight: 800; font-size: 16px; color: #444; }

        /* --- C√ÅC PH·∫¶N KH√ÅC --- */
        h1 { color: var(--primary-color); font-size: 24px; margin: 15px 0; font-weight: 800; }
        h2 { color: #333; font-size: 42px; margin: 5px 0; font-weight: 900; }
        .phonetic { color: #666; font-size: 22px; margin-bottom: 15px; font-family: 'Times New Roman', serif; font-style: italic; }

        .sentence-container { display: none; justify-content: center; flex-wrap: wrap; gap: 8px; margin: 15px 0; }
        .word-block { display: flex; flex-direction: column; align-items: center; }
        .ipa-top { color: var(--error-color); font-size: 16px; font-weight: bold; margin-bottom: 2px; font-family: sans-serif; }
        .text-bottom { color: #333; font-size: 26px; font-weight: 600; }
        
        .btn { 
            border: none; border-radius: 50px; cursor: pointer; margin: 10px 5px; 
            box-shadow: 0 5px 0px rgba(0,0,0,0.1); /* N√∫t b·∫•m n·ªïi */
            transition: all 0.1s; display: inline-flex; align-items: center; justify-content: center; 
            font-weight: bold; color: white; 
            text-transform: uppercase; letter-spacing: 1px;
        }
        .btn:active { transform: translateY(3px); box-shadow: 0 2px 0px rgba(0,0,0,0.1); }
        .btn:disabled { background-color: #ccc !important; color: #888; box-shadow: none; transform: none; cursor: not-allowed;}

        .btn-mic { background-color: var(--success-color); padding: 15px 35px; font-size: 20px; width: 85%; }
        .btn-sample { background-color: var(--primary-color); padding: 10px 25px; font-size: 16px; }
        .btn-reset { background-color: #9C27B0; padding: 10px 30px; font-size: 18px; }

        .nav-container { margin-top: auto; display: flex; justify-content: space-between; padding: 10px 5px 0; width: 100%; box-sizing: border-box;}
        .btn-nav { background-color: var(--secondary-color); padding: 0; font-size: 28px; width: 55px; height: 55px; border-radius: 50%; line-height: 55px; }

        .stars { font-size: 45px; color: var(--secondary-color); height: 55px; margin: 5px 0; text-shadow: 2px 2px 0 rgba(0,0,0,0.1); }
        .feedback { font-size: 18px; color: #555; min-height: 30px; margin-bottom: 15px; font-weight: 600; }
        
        .listening { animation: pulse 1.5s infinite; background-color: var(--error-color) !important; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(242, 80, 34, 0.7); } 70% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(242, 80, 34, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(242, 80, 34, 0); } }
        
        #game-win-msg {
            display:none; color: var(--success-color); font-size: 22px; font-weight: 900; 
            margin-top: 15px; padding: 10px; background: #e6f9e6; border-radius: 10px;
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="card">
    <h1 id="header-title">üêª H·ªçc ph√°t √¢m üê∞</h1>
    
    <div class="content-box" id="content-box">
        <img id="word-img" src="" alt="H√¨nh ·∫£nh minh h·ªça" onerror="handleImgError(this)">
        
        <div id="game-area" class="game-area">
            <div style="color: #555; font-size: 16px; font-weight: 600;">T√¨m 5 c·∫∑p H√¨nh - Ch·ªØ gi·ªëng nhau:</div>
            <div id="memory-grid" class="memory-grid"></div>
            <div id="game-win-msg">üéâ XU·∫§T S·∫ÆC! CHI·∫æN TH·∫ÆNG! üéâ</div>
        </div>
    </div>

    <div id="learning-section">
        <div id="single-word-area">
            <h2 id="word-text">...</h2>
            <div class="phonetic" id="phonetic">...</div>
        </div>
        <div id="sentence-area" class="sentence-container"></div>
        <button class="btn btn-sample" onclick="playSampleSafe()">üîä Nghe m·∫´u</button>
        <div class="stars" id="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</div>
        <div class="feedback" id="feedback">ƒêang kh·ªüi ƒë·ªông...</div>
        <button id="mic-btn" class="btn btn-mic" onclick="startListeningSafe()">üé§ ƒê·ªçc Ngay</button>
    </div>

    <div id="game-controls" style="display:none; margin-top:15px;">
        <button class="btn btn-reset" onclick="setupMemoryGame()">üîÑ Ch∆°i L·∫°i V√°n M·ªõi</button>
    </div>

    <div class="nav-container">
        <button class="btn btn-nav" onclick="prevItem()">‚óÄ</button>
        <button class="btn btn-nav" onclick="nextItem()">‚ñ∂</button>
    </div>
</div>

<script>
    function handleImgError(img) { if(img.src && !img.src.includes('placeholder')) { img.src = 'https://via.placeholder.com/300x200?text=·∫¢nh+L·ªói'; } }

    // --- D·ªÆ LI·ªÜU ---
    const items = [
        // NH√ìM 1: √ÇM /…™r/
        { word: "beer", ipa: "/…™r/", img: "beer.png", type: "word", speakText: "beer", similar: ["bear", "beard", "pier", "beers"] }, 
        { word: "deer", ipa: "/…™r/", img: "deer.png", type: "word", speakText: "deer", similar: ["dear", "dare", "tear", "there"] }, 
        { word: "cheer", ipa: "/…™r/", img: "cheer.png", type: "word", speakText: "cheer", similar: ["chair", "cheers", "sheer", "chia"] }, 
        { word: "tear", ipa: "/…™r/", img: "tear.png", type: "word", speakText: "tier", similar: ["tier", "tea", "here", "tears"] }, 
        { word: "ear", ipa: "/…™r/", img: "ear.png", type: "word", speakText: "ear", similar: ["year", "here", "ears", "air", "yeah", "hear", "near"] }, 
        // NH√ìM 2: √ÇM /…õr/
        { word: "bear", ipa: "/…õr/", img: "bear.png", type: "word", speakText: "bear", similar: ["bare", "beer", "pair", "bears", "bar"] }, 
        { word: "pear", ipa: "/…õr/", img: "pear.png", type: "word", speakText: "pear", similar: ["pair", "pare", "bear", "pears"] }, 
        { word: "share", ipa: "/…õr/", img: "share.png", type: "word", speakText: "share", similar: ["chair", "sure", "cher", "shared"] }, 
        { word: "stair", ipa: "/…õr/", img: "stair.png", type: "word", speakText: "stair", similar: ["stare", "star", "stairs", "stay"] }, 
        { word: "chair", ipa: "/…õr/", img: "chair.png", type: "word", speakText: "chair", similar: ["cheer", "share", "chairs", "care"] },
        
        // C√ÇU
        { 
            type: "sentence", word: "The deer is near the chair", img: "sentence_deer.png",
            htmlParts: [ {text: "The", ipa: "√∞…ô"}, {text: "deer", ipa: "…™r"}, {text: "is", ipa: "…™z"}, {text: "near", ipa: "…™r"}, {text: "the", ipa: "√∞…ô"}, {text: "chair.", ipa: "t É …õr"} ],
            similar: ["the deer is near the chair", "deer near chair"]
        },
        { 
            type: "sentence", word: "The bear shares the pear", img: "sentence_bear.png",
            htmlParts: [ {text: "The", ipa: "√∞…ô"}, {text: "bear", ipa: "…õr"}, {text: "shares", ipa: " É …õr"}, {text: "the", ipa: "√∞…ô"}, {text: "pear.", ipa: "…õr"} ],
            similar: ["the bear shares the pear", "bear shares pear"]
        },

        // GAME L·∫¨T H√åNH
        { type: "game", title: "Game L·∫≠t H√¨nh /…™r/", gameData: ["beer", "deer", "cheer", "tear", "ear"] },
        { type: "game", title: "Game L·∫≠t H√¨nh /…õr/", gameData: ["bear", "pear", "share", "stair", "chair"] }
    ];

    let currentIndex = 0;
    let recognition;
    let recognitionTimeout;
    let audioWin, audioCorrect, audioWrong;
    
    // Bi·∫øn cho Game Memory
    let hasFlippedCard = false;
    let lockBoard = false;
    let firstCard, secondCard;
    let matchedPairs = 0;

    // --- KH·ªûI T·∫†O AN TO√ÄN ---
    window.onload = function() {
        try {
            document.getElementById('feedback').innerText = "S·∫µn s√†ng!";
            loadItem(0, false);
            try { audioWin = new Audio("win.mp3"); } catch(e){}
            try { audioCorrect = new Audio("correct.mp3"); } catch(e){}
            try { audioWrong = new Audio("wrong.mp3"); } catch(e){}
        } catch (e) { console.error(e); }
    };

    function loadItem(index, autoPlay = true) {
        try {
            const item = items[index];
            const learningSection = document.getElementById('learning-section');
            const gameArea = document.getElementById('game-area');
            const gameControls = document.getElementById('game-controls');
            const imgEl = document.getElementById('word-img');
            const contentBox = document.getElementById('content-box');

            window.speechSynthesis.cancel();
            resetState();

            if (item.type === 'game') {
                document.getElementById('header-title').innerText = "üéÆ " + item.title;
                learningSection.style.display = 'none';
                imgEl.style.display = 'none';
                gameArea.style.display = 'flex';
                gameControls.style.display = 'block';
                contentBox.style.backgroundColor = "#eef2f7"; /* M√†u n·ªÅn b√†n ch∆°i */
                setupMemoryGame();
            } else {
                document.getElementById('header-title').innerText = "üêª H·ªçc ph√°t √¢m üê∞";
                learningSection.style.display = 'block';
                imgEl.style.display = 'block';
                gameArea.style.display = 'none';
                gameControls.style.display = 'none';
                contentBox.style.backgroundColor = "#fff"; /* N·ªÅn tr·∫Øng cho b√†i h·ªçc */
                
                if(item.img) imgEl.src = item.img;

                if (item.type === 'sentence') {
                    document.getElementById('single-word-area').style.display = 'none';
                    document.getElementById('sentence-area').style.display = 'flex';
                    const container = document.getElementById('sentence-area');
                    container.innerHTML = ''; 
                    item.htmlParts.forEach(part => {
                        const block = document.createElement('div');
                        block.className = 'word-block';
                        block.innerHTML = `<div class="ipa-top">${part.ipa}</div><div class="text-bottom">${part.text}</div>`;
                        container.appendChild(block);
                    });
                } else {
                    document.getElementById('single-word-area').style.display = 'block';
                    document.getElementById('sentence-area').style.display = 'none';
                    document.getElementById('word-text').innerText = item.word ? item.word.toUpperCase() : "ERR";
                    document.getElementById('phonetic').innerText = item.ipa;
                }
                if(autoPlay) setTimeout(() => { playSampleSafe(); }, 500);
            }
        } catch(e) { console.error(e); }
    }

    // --- LOGIC GAME MEMORY (C·∫≠p nh·∫≠t hi·ªáu ·ª©ng) ---
    function setupMemoryGame() {
        const currentItem = items[currentIndex];
        const targetWords = currentItem.gameData;
        const grid = document.getElementById('memory-grid');
        const winMsg = document.getElementById('game-win-msg');
        
        grid.innerHTML = "";
        winMsg.style.display = "none";
        
        hasFlippedCard = false;
        lockBoard = false;
        firstCard = null;
        secondCard = null;
        matchedPairs = 0;

        let cards = [];
        targetWords.forEach(wordKey => {
            let originalObj = items.find(i => i.word === wordKey);
            if(originalObj) {
                cards.push({ key: wordKey, type: 'img', content: `<img src="${originalObj.img}">` });
                cards.push({ key: wordKey, type: 'text', content: `<span>${wordKey.toUpperCase()}</span>` });
            }
        });

        cards.sort(() => 0.5 - Math.random());

        cards.forEach(cardData => {
            const cardEl = document.createElement('div');
            cardEl.classList.add('memory-card');
            cardEl.dataset.key = cardData.key;
            // Th√™m s·ª± ki·ªán ch·∫°m cho mobile ƒë·ªÉ lo·∫°i b·ªè delay
            cardEl.addEventListener('touchstart', function(e) { e.preventDefault(); flipCard.call(this); }, {passive: false});
            cardEl.addEventListener('click', flipCard);
            
            cardEl.innerHTML = `
                <div class="memory-inner">
                    <div class="memory-front">?</div>
                    <div class="memory-back">${cardData.content}</div>
                </div>
            `;
            grid.appendChild(cardEl);
        });
    }

    function flipCard() {
        if (lockBoard) return;
        if (this === firstCard) return;

        this.classList.add('flipped');

        if (!hasFlippedCard) {
            hasFlippedCard = true;
            firstCard = this;
            return;
        }

        secondCard = this;
        checkForMatch();
    }

    function checkForMatch() {
        let isMatch = firstCard.dataset.key === secondCard.dataset.key;

        if (isMatch) {
            disableCards();
            playSoundSafeLocal('correct');
            let u = new SpeechSynthesisUtterance(firstCard.dataset.key);
            u.lang = 'en-US';
            window.speechSynthesis.speak(u);
        } else {
            playSoundSafeLocal('wrong');
            unflipCards();
        }
    }

    function disableCards() {
        lockBoard = true; // Kh√≥a b·∫£ng t·∫°m th·ªùi ƒë·ªÉ tr√°nh b·∫•m lung tung khi ƒëang hi·ªáu ·ª©ng
        setTimeout(() => {
            firstCard.classList.add('matched');
            secondCard.classList.add('matched');
            resetBoard();
        }, 600); // ƒê·ª£i l·∫≠t xong m·ªõi b√°o ƒë√∫ng

        matchedPairs++;
        if (matchedPairs === 5) {
            setTimeout(() => {
                document.getElementById('game-win-msg').style.display = 'block';
                playSoundSafeLocal('win');
            }, 1000);
        }
    }

    function unflipCards() {
        lockBoard = true;
        // Th√™m hi·ªáu ·ª©ng rung l·∫Øc
        firstCard.classList.add('shake');
        secondCard.classList.add('shake');

        setTimeout(() => {
            firstCard.classList.remove('flipped', 'shake');
            secondCard.classList.remove('flipped', 'shake');
            resetBoard();
        }, 1000);
    }

    function resetBoard() {
        [hasFlippedCard, lockBoard] = [false, false];
        [firstCard, secondCard] = [null, null];
    }

    // --- ƒêI·ªÄU H∆Ø·ªöNG & H·ªñ TR·ª¢ ---
    function nextItem() { if (currentIndex < items.length - 1) { currentIndex++; loadItem(currentIndex, true); } }
    function prevItem() { if (currentIndex > 0) { currentIndex--; loadItem(currentIndex, true); } }
    
    function resetState() {
        document.getElementById('stars').innerText = "‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ";
        document.getElementById('mic-btn').disabled = false;
        document.getElementById('mic-btn').innerText = "üé§ ƒê·ªçc Ngay";
        document.getElementById('feedback').className = "feedback";
        clearTimeout(recognitionTimeout);
    }
    
    function playSampleSafe() {
        if(items[currentIndex].type === 'game') return;
        try {
            window.speechSynthesis.cancel();
            const item = items[currentIndex];
            const textToSpeak = item.speakText || item.word;
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = 'en-US'; utterance.rate = item.type === 'sentence' ? 0.7 : 0.8;
            window.speechSynthesis.speak(utterance);
        } catch (e) {}
    }

    function startListeningSafe() {
        if(items[currentIndex].type === 'game') return;
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) { alert("D√πng Chrome/Safari nh√©."); return; }
        try {
            window.speechSynthesis.cancel();
            recognition = new SpeechRecognition();
            recognition.lang = 'en-US'; recognition.interimResults = false; recognition.maxAlternatives = 10; recognition.continuous = false;
            document.getElementById('mic-btn').innerText = "üëÇ ƒêang nghe..."; document.getElementById('mic-btn').disabled = true;
            document.getElementById('feedback').innerText = "ƒêang nghe..."; document.getElementById('feedback').className = "feedback listening";
            recognition.start();
            const waitTime = items[currentIndex].type === 'sentence' ? 10000 : 8000;
            clearTimeout(recognitionTimeout);
            recognitionTimeout = setTimeout(() => { try { recognition.stop(); } catch(e){} document.getElementById('feedback').innerText = "H·∫øt gi·ªù!"; resetBtn(); }, waitTime); 
            recognition.onresult = function(event) {
                clearTimeout(recognitionTimeout);
                let heardWords = [];
                for(let i = 0; i < event.results[0].length; i++) { heardWords.push(event.results[0][i].transcript.toLowerCase()); }
                checkResultSmart(heardWords);
            };
            recognition.onerror = function() { clearTimeout(recognitionTimeout); document.getElementById('feedback').innerText = "Th·ª≠ l·∫°i n√†o!"; resetBtn(); };
            recognition.onend = function() { if(document.getElementById('mic-btn').disabled) resetBtn(); };
        } catch (e) { resetBtn(); }
    }

    function checkResultSmart(heardWords) {
        const currentData = items[currentIndex];
        const targetText = currentData.word.toLowerCase();
        const cleanTarget = targetText.replace(/[.,]/g, "");
        const validList = currentData.similar || [];
        let isPerfect = heardWords.some(w => w.replace(/[.,]/g, "").includes(cleanTarget) || validList.includes(w.replace(/[.,]/g, "")));
        if (isPerfect) { showResult(5, "Tuy·ªát v·ªùi!"); return; }
        let bestGuess = heardWords[0];
        if (currentData.type === 'sentence') {
            const targetWordsArr = cleanTarget.split(" "); let matchCount = 0;
            targetWordsArr.forEach(tw => { if (bestGuess.includes(tw)) matchCount++; });
            if (matchCount >= targetWordsArr.length / 2) showResult(3, "Kh√° l·∫Øm!"); else showResult(2, "C·ªë l√™n!");
        } else {
            if (bestGuess.charAt(0) === targetText.charAt(0)) showResult(4, "G·∫ßn ƒë√∫ng!"); else showResult(2, "C·ªë l√™n!");
        }
    }

    function showResult(starCount, message) {
        let stars = ""; for (let i = 0; i < 5; i++) { stars += (i < starCount) ? "‚≠ê" : "‚òÜ"; }
        document.getElementById('stars').innerText = stars;
        document.getElementById('feedback').innerText = message;
        document.getElementById('feedback').className = "feedback";
        playSoundSafeLocal(starCount === 5 ? 'win' : (starCount >= 3 ? 'correct' : 'wrong'));
        resetBtn();
    }
    function resetBtn() { document.getElementById('mic-btn').disabled = false; document.getElementById('mic-btn').innerText = "üé§ ƒê·ªçc Ngay"; document.getElementById('feedback').className = "feedback"; }
    function playSoundSafeLocal(type) {
        try {
            let s; if(type==='win') s = audioWin; else if(type==='correct') s = audioCorrect; else s = audioWrong;
            if(s) s.play().catch(e=>{});
        } catch(e){}
    }
</script>

</body>
</html>
