<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc ti·∫øng Anh th·∫≠t d·ªÖ</title>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #e0f7fa; text-align: center; padding: 10px; }
        
        /* Container ch√≠nh */
        .card { background: white; border-radius: 20px; padding: 20px; max-width: 600px; margin: 0 auto; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border: 5px solid #FFD700; min-height: 550px; position: relative; }
        
        /* Khu v·ª±c hi·ªÉn th·ªã H√¨nh ·∫£nh / Game */
        .content-box { width: 100%; height: 300px; margin: 0 auto; overflow: hidden; border-radius: 15px; border: 2px dashed #ddd; background: #fff; display: flex; align-items: center; justify-content: center; position: relative; }
        img { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        /* Iframe cho Game */
        iframe { width: 100%; height: 100%; border: none; }

        h1 { color: #ff6f00; font-size: 24px; margin: 10px 0; }
        
        /* Style cho T·ª´ ƒë∆°n */
        h2 { color: #333; font-size: 40px; margin: 5px 0; letter-spacing: 2px; }
        .phonetic { color: #888; font-size: 20px; margin-bottom: 10px; font-family: 'Times New Roman', serif; }

        /* Style cho C√¢u */
        .sentence-container { display: none; justify-content: center; flex-wrap: wrap; gap: 10px; margin: 10px 0; }
        .word-block { display: flex; flex-direction: column; align-items: center; }
        .ipa-top { color: #ff3b30; font-size: 18px; font-weight: bold; margin-bottom: -5px; font-family: sans-serif; }
        .text-bottom { color: #000; font-size: 28px; font-weight: normal; }
        
        /* N√∫t b·∫•m */
        .btn { border: none; border-radius: 50px; cursor: pointer; margin: 10px 5px; box-shadow: 0 4px #999; transition: 0.1s; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; color: white; }
        .btn:active { transform: translateY(4px); box-shadow: 0 0 #666; }
        .btn:disabled { background-color: #ccc !important; color: #666; cursor: not-allowed; box-shadow: none; transform: none; }

        .btn-mic { background-color: #4CAF50; padding: 15px 30px; font-size: 20px; width: 80%; }
        .btn-sample { background-color: #2196F3; padding: 10px 20px; font-size: 16px; }
        
        /* N√∫t ƒëi·ªÅu h∆∞·ªõng to r√µ */
        .nav-container { margin-top: 20px; display: flex; justify-content: space-between; padding: 0 10px; }
        .btn-nav { background-color: #FF9800; padding: 10px; font-size: 20px; width: 50px; height: 50px; border-radius: 50%; }

        /* Khu v·ª±c ch·∫•m ƒëi·ªÉm */
        .stars { font-size: 40px; color: #FFD700; height: 50px; margin: 5px 0; }
        .feedback { font-size: 16px; color: #555; min-height: 40px; margin-bottom: 10px; font-style: italic; padding: 5px; border: 1px dotted #ccc; border-radius: 5px;}
        
        .listening { animation: pulse 1.5s infinite; background-color: #ff5722 !important; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="card">
    <h1 id="header-title">üêª H·ªçc ph√°t √¢m üê∞</h1>
    
    <div class="content-box" id="content-box">
        <img id="word-img" src="" alt="Word Image" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200?text=No+Image';">
        <iframe id="game-frame" src="" style="display:none;" allowfullscreen></iframe>
    </div>

    <div id="learning-section">
        <div id="single-word-area">
            <h2 id="word-text">WORD</h2>
            <div class="phonetic" id="phonetic">/IPA/</div>
        </div>

        <div id="sentence-area" class="sentence-container"></div>

        <button class="btn btn-sample" onclick="playSampleSafe()">üîä Nghe m·∫´u</button>

        <div class="stars" id="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</div>
        <div class="feedback" id="feedback">ƒêang t·∫£i...</div>

        <button id="mic-btn" class="btn btn-mic" onclick="startListeningSafe()">üé§ ƒê·ªçc Ngay</button>
    </div>

    <div id="game-controls" style="display:none; margin-top:10px;">
        <p style="color:#555; font-style:italic;">Ch·ªù game t·∫£i x√≠u nh√©...</p>
        <a id="game-link-btn" href="" target="_blank" class="btn" style="background-color: #9C27B0; text-decoration: none; padding: 10px 20px;">üéÆ M·ªü Game L·ªõn (N·∫øu l·ªói)</a>
    </div>

    <div class="nav-container">
        <button class="btn btn-nav" onclick="prevItem()">‚óÄ</button>
        <button class="btn btn-nav" onclick="nextItem()">‚ñ∂</button>
    </div>
</div>

<script>
    /* DANH S√ÅCH B√ÄI H·ªåC */
    const items = [
        // --- PH·∫¶N 1: T·ª™ V·ª∞NG ---
        { word: "beer", ipa: "/…™r/", img: "beer.png", type: "word", speakText: "beer", similar: ["bear", "beard", "pier", "beers"] }, 
        { word: "deer", ipa: "/…™r/", img: "deer.png", type: "word", speakText: "deer", similar: ["dear", "dare", "tear", "there"] }, 
        { word: "cheer", ipa: "/…™r/", img: "cheer.png", type: "word", speakText: "cheer", similar: ["chair", "cheers", "sheer", "chia"] }, 
        { word: "tear", ipa: "/…™r/", img: "tear.png", type: "word", speakText: "tier", similar: ["tier", "tea", "here", "tears"] }, 
        { word: "ear", ipa: "/…™r/", img: "ear.png", type: "word", speakText: "ear", similar: ["year", "here", "ears", "air", "yeah", "hear", "near"] }, 
        
        { word: "bear", ipa: "/…õr/", img: "bear.png", type: "word", speakText: "bear", similar: ["bare", "beer", "pair", "bears", "bar"] }, 
        { word: "pear", ipa: "/…õr/", img: "pear.png", type: "word", speakText: "pear", similar: ["pair", "pare", "bear", "pears"] }, 
        { word: "share", ipa: "/…õr/", img: "share.png", type: "word", speakText: "share", similar: ["chair", "sure", "cher", "shared"] }, 
        { word: "stair", ipa: "/…õr/", img: "stair.png", type: "word", speakText: "stair", similar: ["stare", "star", "stairs", "stay"] }, 
        { word: "chair", ipa: "/…õr/", img: "chair.png", type: "word", speakText: "chair", similar: ["cheer", "share", "chairs", "care"] },

        // --- PH·∫¶N 2: C√ÇU ---
        { 
            type: "sentence",
            word: "The deer is near the chair", 
            img: "sentence_deer.png",
            htmlParts: [ {text: "The", ipa: "√∞…ô"}, {text: "deer", ipa: "…™r"}, {text: "is", ipa: "…™z"}, {text: "near", ipa: "…™r"}, {text: "the", ipa: "√∞…ô"}, {text: "chair.", ipa: "t É …õr"} ],
            similar: ["the deer is near the chair", "deer near chair"]
        },
        { 
            type: "sentence",
            word: "The bear shares the pear",
            img: "sentence_bear.png",
            htmlParts: [ {text: "The", ipa: "√∞…ô"}, {text: "bear", ipa: "…õr"}, {text: "shares", ipa: " É …õr"}, {text: "the", ipa: "√∞…ô"}, {text: "pear.", ipa: "…õr"} ],
            similar: ["the bear shares the pear", "bear shares pear"]
        },

        // --- PH·∫¶N 3: TR√í CH∆†I WORDWALL (ƒê√£ s·ª≠a ti√™u ƒë·ªÅ) ---
        { 
            type: "game", 
            title: "Tr√≤ ch∆°i v·ªõi √¢m /…™r/", // S·ª≠a ti√™u ƒë·ªÅ 1
            url: "https://wordwall.net/embed/resource/103738616" 
        },
        { 
            type: "game", 
            title: "Tr√≤ ch∆°i v·ªõi √¢m /…õr/", // S·ª≠a ti√™u ƒë·ªÅ 2
            url: "https://wordwall.net/embed/resource/103753995" 
        }
    ];

    let currentIndex = 0;
    let recognition;
    let recognitionTimeout;
    let audioWin, audioCorrect, audioWrong;

    window.onload = function() {
        try {
            document.getElementById('feedback').innerText = "S·∫µn s√†ng! B·∫•m n√∫t ƒë·ªÉ h·ªçc.";
            loadItem(0);
            audioWin = new Audio("win.mp3");
            audioCorrect = new Audio("correct.mp3");
            audioWrong = new Audio("wrong.mp3");
        } catch (e) {}
    };

    function loadItem(index) {
        const item = items[index];
        const learningSection = document.getElementById('learning-section');
        const gameControls = document.getElementById('game-controls');
        const imgEl = document.getElementById('word-img');
        const iframeEl = document.getElementById('game-frame');
        const contentBox = document.getElementById('content-box');

        // Reset: H·ªßy ƒë·ªçc c≈©, reset giao di·ªán
        window.speechSynthesis.cancel();
        resetState();

        if (item.type === 'game') {
            // --- CH·∫æ ƒê·ªò GAME ---
            document.getElementById('header-title').innerText = "üéÆ " + item.title;
            
            learningSection.style.display = 'none';
            gameControls.style.display = 'block';
            contentBox.style.height = "450px"; 
            
            imgEl.style.display = 'none';
            iframeEl.style.display = 'block';
            iframeEl
